<section class="hero is-light is-medium is-bold" id="dashboard_hero">
  <div class="hero-body">
    <div class="container">
      <div class="columns">
        <div class="column">
          <h1 class="title">
            <%= @greeting %>, <%= @user.username + " &#128075;" %>
          </h1>
          <h2 class="subtitle">
            <% if @owned_products == 0 %>
              You don't have any products to work on yet.
              <a href="/products/new" class="button is-small is-primary is-outlined">Create your first product</a>
            <% else %>
              You have <%= @owned_products %> products to work on.
            <% end %>
          </h2>
        </div>
        <!-- <div class="column">
          <div>
            <span class="level is-centered">
              <div class="is-grouped">
                <div class="level-item has-text-centered">
                  <div>
                    <p class="heading">Account Balance</p>
                    <p class="title">$<%= sprintf "%.2f", @user.balance %></p>
                  </div>
                </div>
                <div class="level-item has-text-centered">
                  <div>
                    <p class="heading">Incomplete Tasks</p>
                    <p class="tag is-dark is-large"><%= @user.open_claimed_tasks.count %></p>
                  </div>
                </div>
              </div>
              <div class="is-grouped">
                <div class="level-item has-text-centered">
                  <div>
                    <p class="heading">Ready to Withdraw</p>
                    <p class="title"><span class="tag is-dark">Coming soon</span></p>
                  </div>
                </div>
                <div class="level-item has-text-centered">
                  <div>
                    <p class="heading">Claimed Task Value</p>
                    <p class="tag is-success is-large">$<%= sprintf "%.2f", @user.claimed_task_value %></p>
                  </div>
                </div>
              </div>
            </span>
          </div>
        </div> -->
        <div class="column">
          <nav class="level">
            <div class="level-item has-text-centered">
              <div>
                <p class="heading">Current Tasks</p>
                <p class="title"><%= @user.open_claimed_tasks.count %></p>
              </div>
            </div>

            <div class="level-item has-text-centered">
              <div>
                <p class="heading">Current Task Value</p>
                <p class="tag is-info is-large">
                  $<%= sprintf "%.2f", @user.claimed_task_value %>
                </p>
              </div>
            </div>
            <div class="level-item has-text-centered">
              <div>
                <p class="heading">Account Balance</p>
                <p class="tag is-warning is-large">
                  $<%= sprintf "%.2f", @user.balance %>
                </p>
              </div>
            </div>
            <div class="level-item has-text-centered">
              <div>
                <p class="heading">Ready to Withdraw</p>
                <p class="tag is-success is-large">
                  $<%= sprintf "%.2f", @user.balance %>
                </p>
              </div>
            </div>
          </nav>

        </div>



      </div>
    </div>
  </div>
</section>

<br>

<section class="container" id="dashboard-tasks-table-section">
  <h2 class="title">Your Claimed Tasks</h2>
  <table class="table">

    <thead>
      <tr>
        <th>ID</th>
        <th>Product</th>
        <th>Version</th>
        <th>Name</th>
        <th>Description</th>
        <th>Reward</th>
        <th>Status</th>
      </tr>
    </thead>

    <tbody>
      <% @user.claimed_tasks.each do |task| %>
      <tr>
        <th><%= task.id %></th>
        <td><a href="/products/<%= task.product.slug %>">
          <%= task.product.name %></a>
        </td>
        <td>
          <a href="/products/<%= task.product.slug %>/versions/<%= task.version.version_number %>"><%= task.version.version_number %></a>
        </td>
        <td><strong><%= task.name %></strong></td>
        <td><%= task.description %></td>
        <td>
          <strong class="has-text-success">
            $ <%= sprintf "%.2f", task.reward %>
          </strong>
        </td>
        <td><%= task.status %></td>
      </tr>
      <% end %>
    </tbody>
  </table>
</section>

<section class="container" id="dashboard-products-table-section">
  <h2 class="title">Your Products</h2>
  <a href="/products/new" class="button is-small">New product</a>
  <table class="table">

    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Description</th>
        <th>Status</th>
        <th>Repository</th>
        <th>Current Station</th>
        <th>Last update</th>
      </tr>
    </thead>

    <tbody>
      <% @user.products.each do |product| %>
      <tr>
        <th><%= product.id %></th>
        <td><a href="/products/<%= product.slug %>">
          <%= product.name %></a>
        </td>
        <td><%= product.description %></td>
        <td><%= product.status %></td>
        <td>
          <a href="<%= product.git_repo %>"><%= product.git_repo %></a>
        </td>
        <td>
          <% if product.versions.empty? %>
          <a class="button is-primary" href="/products<%=product.slug%>/new_version">new version</a>
          <% else %>
          <i class="fas fa-subway"></i>
          <a href="/products/<%=product.slug%>/versions/<%=product.versions.last.version_number%>">
            <%= product.versions.last.version_number %>
          </a>
          <% end %>
        </td>
        <td><%= product.updated_at.strftime("%B %-d, %Y, %H:%M") %></td>
      </tr>
      <% end %>
    </tbody>
  </table>
</section>
